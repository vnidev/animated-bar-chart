(function(a){a.fn.animatedBarChart=function(c){var l=this;var q=a(l).attr("id");var h=a.extend(true,{},{data:[],params:{group_name:"group_name",name:"name",value:"value"},horizontal_bars:false,chart_height:400,colors:null,show_legend:true,legend:{position:LegendPosition.bottom,width:200},x_grid_lines:true,y_grid_lines:true,tweenDuration:300,bars:{padding:0.075,opacity:0.7,opacity_hover:0.45,disable_hover:false,hover_name_text:"name",hover_value_text:"value",},number_format:{format:",.2f",decimal:".",thousands:",",grouping:[3],currency:["$"]},margin:{top:0,right:35,bottom:20,left:70},rotate_x_axis_labels:{process:true,minimun_resolution:720,bottom_margin:15,rotating_angle:90,x_position:9,y_position:-3}},c);var r,m,d,u,f,j,g,t,k=0,n=false,o,b=[],s,p;function e(){return d3.axisBottom(f)}function i(){return d3.axisLeft(j)}l.init=function(){if(!h.colors){h.colors=[];var v=d3.scaleOrdinal(d3.schemeCategory10);for(var x=0;x<10;x++){h.colors.push(v(x))}}if(!h.bars.disable_hover){k=20}a.each(h.data,function(z,A){b.push(A[h.params.group_name])});b=a.unique(b);if(a(document).width()<h.rotate_x_axis_labels.minimun_resolution&&h.rotate_x_axis_labels.process){h.margin.bottom=h.margin.bottom+h.rotate_x_axis_labels.bottom_margin;n=true}d3.formatDefaultLocale(h.number_format);p=d3.format(h.number_format.format);var w=a("#"+q);d=w.width();u=h.chart_height;var y=d3.select("#"+q);if(h.show_legend&&(h.legend.position==LegendPosition.left||h.legend.position==LegendPosition.top)){if(h.legend.position==LegendPosition.left){o=d3.select("#"+q).append("div").attr("class","legend_div_side").attr("style","min-width: "+h.legend.width+"px").append("ul")}else{o=d3.select("#"+q).append("div").attr("class","legend_div").append("ul")}}if(h.show_legend&&(h.legend.position==LegendPosition.right||h.legend.position==LegendPosition.left)){if(a(document).width()>768){d=d-h.legend.width}y=d3.select("#"+q).attr("style","display: table; width: 100%").append("div").attr("class","svg_legend_div_side")}r=y.append("svg").attr("width","100%").attr("height",h.chart_height).attr("viewBox","0 0 "+d+" "+u).attr("preserveAspectRatio","none");m=r.append("g").attr("class","svg_chart").attr("transform","translate("+h.margin.left+", "+(h.margin.top+k)+")");if(h.horizontal_bars){f=d3.scaleLinear().range([0,d-h.margin.left-h.margin.right]).domain([0,d3.max(h.data,function(z){return z[h.params.value]})]);j=d3.scaleBand().range([u-h.margin.top-h.margin.bottom-k,0]).domain(h.data.map(function(z){return z[h.params.name]})).padding(h.bars.padding)}else{f=d3.scaleBand().range([0,d-h.margin.left-h.margin.right]).domain(h.data.map(function(z){return z[h.params.name]})).padding(h.bars.padding);j=d3.scaleLinear().range([u-h.margin.top-h.margin.bottom-k,0]).domain([0,d3.max(h.data,function(z){return z[h.params.value]})])}m.append("g").attr("class","xaxis").attr("transform","translate(0, "+(u-h.margin.top-h.margin.bottom-k)+")").call(d3.axisBottom(f));m.append("g").attr("class","yaxis").call(d3.axisLeft(j).ticks(5));s=m.append("g").attr("class","chart_container");if(h.x_grid_lines){g=m.append("g").attr("class","x_lines").attr("transform","translate(0,"+(u-h.margin.top-h.margin.bottom-k)+")")}if(h.y_grid_lines){t=m.append("g").attr("class","y_lines")}if(h.show_legend&&(h.legend.position==LegendPosition.right||h.legend.position==LegendPosition.bottom)){if(h.legend.position==LegendPosition.right){o=d3.select("#"+q).append("div").attr("class","legend_div_side").attr("style","min-width: "+h.legend.width+"px").append("ul")}else{o=d3.select("#"+q).append("div").attr("class","legend_div").append("ul")}}l.render()};l.render=function(){if(h.horizontal_bars){f.domain([0,d3.max(h.data,function(y){return y[h.params.value]})]);m.select(".xaxis").transition().duration(h.tweenDuration).call(d3.axisBottom(f));j.domain(h.data.map(function(y){return y[h.params.name]}));m.select(".yaxis").transition().duration(h.tweenDuration).call(d3.axisLeft(j))}else{j.domain([0,d3.max(h.data,function(y){return y[h.params.value]})]);m.select(".yaxis").transition().duration(h.tweenDuration).call(d3.axisLeft(j));f.domain(h.data.map(function(y){return y[h.params.name]}));m.select(".xaxis").transition().duration(h.tweenDuration).call(d3.axisBottom(f))}if(n){m.select(".xaxis").selectAll("text").transition().duration(h.tweenDuration).attr("y",h.rotate_x_axis_labels.y_position).attr("x",h.rotate_x_axis_labels.x_position).attr("transform","rotate("+h.rotate_x_axis_labels.rotating_angle+")").style("text-anchor","start")}if(h.x_grid_lines){g.transition().duration(h.tweenDuration).call(e().tickSize(-(u-h.margin.top-h.margin.bottom-k)).tickFormat(""))}if(h.y_grid_lines){t.transition().duration(h.tweenDuration).call(i().tickSize(-(d-h.margin.left-h.margin.right)).tickFormat(""))}if(h.show_legend){l.addChartLegend()}var v=s.selectAll("rect").data(h.data);var x=v.enter().append("rect").attr("class","bar_item").style("fill",function(A,z){var y=l.getDistinctDataIndex(A[h.params.group_name]);return h.colors[y]}).style("opacity",h.bars.opacity).on("mouseover",function(A,z){if(!h.bars.disable_hover){var y=A[h.params.group_name]+", "+h.bars.hover_name_text+": "+A[h.params.name]+", "+h.bars.hover_value_text+": "+p(A[h.params.value]);r.append("text").attr("class","title-text").style("fill",function(){var B=l.getDistinctDataIndex(A[h.params.group_name]);return h.colors[B]}).text(y).attr("text-anchor","middle").attr("x",(d)/2).attr("y",k-7);d3.select(this).style("opacity",h.bars.opacity_hover).style("cursor","pointer")}}).on("mouseout",function(y){if(!h.bars.disable_hover){r.select(".title-text").remove();d3.select(this).style("opacity",h.bars.opacity)}});if(h.horizontal_bars){x.attr("x",function(y){return f(0)}).attr("y",function(A,z){var y=l.getDistinctDataIndex(A[h.params.group_name]);return j(A[h.params.name])+(y*j.bandwidth()/b.length)}).attr("width",0).attr("height",function(y){return j.bandwidth()/b.length}).transition().duration(h.tweenDuration).attr("width",function(y){return f(y[h.params.value])})}else{x.attr("x",function(A,z){var y=l.getDistinctDataIndex(A[h.params.group_name]);return f(A[h.params.name])+(y*f.bandwidth()/b.length)}).attr("y",function(y){return j(0)}).attr("width",function(y){return f.bandwidth()/b.length}).attr("height",0).transition().duration(h.tweenDuration).attr("y",function(y){return j(y[h.params.value])}).attr("height",function(y){return u-h.margin.top-h.margin.bottom-k-j(y[h.params.value])})}var w=v.data(h.data).transition().duration(h.tweenDuration).style("fill",function(A,z){var y=l.getDistinctDataIndex(A[h.params.group_name]);return h.colors[y]});if(h.horizontal_bars){w.attr("y",function(A,z){var y=l.getDistinctDataIndex(A[h.params.group_name]);return j(A[h.params.name])+(y*j.bandwidth()/b.length)}).attr("height",function(y){return j.bandwidth()/b.length}).attr("width",function(y){return f(y[h.params.value])})}else{w.attr("x",function(A,z){var y=l.getDistinctDataIndex(A[h.params.group_name]);return f(A[h.params.name])+(y*f.bandwidth()/b.length)}).attr("width",f.bandwidth()/b.length).attr("y",function(y){return j(y[h.params.value])}).attr("height",function(y){return u-h.margin.top-h.margin.bottom-k-j(y[h.params.value])})}v.exit().transition().duration(h.tweenDuration).style("opacity",0).remove()};l.updateChart=function(v){h=a.extend(h,v);b=[];a.each(h.data,function(w,x){b.push(x[h.params.group_name])});b=a.unique(b);l.render()};l.addChartLegend=function(){var x=o.selectAll("li").data(b);var v=x.enter().append("li");v.append("div").attr("style",function(z,y){return"background-color: "+h.colors[y]});v.append("p").text(function(y){return y});var w=x.data(b);w.select("div").attr("style",function(z,y){return"background-color: "+h.colors[y]});w.select("p").text(function(y){return y});x.exit().remove()};l.getDistinctDataIndex=function(w){var v=0;a.each(b,function(x,y){if(w==y){v=x;return false}});return v};l.init();return l}}(jQuery));const LegendPosition={top:0,bottom:1,left:2,right:3};
