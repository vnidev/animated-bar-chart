(function(n){n.fn.animatedBarChart=function(t){function tt(){return d3.axisBottom(e)}function it(){return d3.axisLeft(o)}var u=this,a=n(u).attr("id"),i=n.extend(!0,{},{data:[],params:{group_name:"group_name",name:"name",value:"value"},chart_height:400,colors:null,show_legend:!0,x_grid_lines:!0,y_grid_lines:!0,tweenDuration:300,bars:{padding:.075,opacity:.7,opacity_hover:.45,disable_hover:!1,hover_name_text:"name",hover_value_text:"value"},number_format:{format:",.2f",decimal:".",thousands:",",grouping:[3],currency:["$"]},margin:{top:0,right:35,bottom:20,left:70},rotate_x_axis_labels:{process:!0,minimun_resolution:720,bottom_margin:15,rotating_angle:90,x_position:9,y_position:-3}},t),p,c,f,r,v,w,b,k,d;if(!i.colors)for(i.colors=[],p=d3.scaleOrdinal(d3.schemeCategory10),c=0;c<10;c++)i.colors.push(p(c));f=0;i.bars.disable_hover||(f=20);r=[];n.each(i.data,function(n,t){r.push(t[i.params.group_name])});r=n.unique(r);v=!1;n(document).width()<i.rotate_x_axis_labels.minimun_resolution&&i.rotate_x_axis_labels.process&&(i.margin.bottom=i.margin.bottom+i.rotate_x_axis_labels.bottom_margin,v=!0);d3.formatDefaultLocale(i.number_format);var g=d3.format(i.number_format.format),nt=n("#"+a),l=nt.width(),h=i.chart_height,y=d3.select("#"+a).append("svg").attr("width","100%").attr("height",i.chart_height).attr("viewBox","0 0 "+l+" "+h).attr("preserveAspectRatio","none"),s=y.append("g").attr("class","svg_chart").attr("transform","translate("+i.margin.left+", "+i.margin.top+f+")"),e=d3.scaleBand().range([0,l-i.margin.left-i.margin.right]).domain(i.data.map(function(n){return n[i.params.name]})).padding(i.bars.padding),o=d3.scaleLinear().range([h-i.margin.top-i.margin.bottom-f,0]).domain([0,d3.max(i.data,function(n){return n[i.params.value]})]);return s.append("g").attr("class","xaxis").attr("transform","translate(0, "+(h-i.margin.top-i.margin.bottom-f)+")").call(d3.axisBottom(e)),s.append("g").attr("class","yaxis").call(d3.axisLeft(o).ticks(5)),w=s.append("g").attr("class","chart_container"),i.x_grid_lines&&(b=s.append("g").attr("class","x_lines").attr("transform","translate(0,"+(h-i.margin.top-i.margin.bottom-f)+")")),i.y_grid_lines&&(k=s.append("g").attr("class","y_lines")),i.show_legend&&(d=d3.select("#"+a).append("div").attr("class","legend_div").append("ul")),u.render=function(){o.domain([0,d3.max(i.data,function(n){return n[i.params.value]})]);s.select(".yaxis").transition().duration(i.tweenDuration).call(d3.axisLeft(o));e.domain(i.data.map(function(n){return n[i.params.name]}));s.select(".xaxis").transition().duration(i.tweenDuration).call(d3.axisBottom(e));v&&s.select(".xaxis").selectAll("text").transition().duration(i.tweenDuration).attr("y",i.rotate_x_axis_labels.y_position).attr("x",i.rotate_x_axis_labels.x_position).attr("transform","rotate("+i.rotate_x_axis_labels.rotating_angle+")").style("text-anchor","start");i.x_grid_lines&&b.transition().duration(i.tweenDuration).call(tt().tickSize(-(h-i.margin.top-i.margin.bottom-f)).tickFormat(""));i.y_grid_lines&&k.transition().duration(i.tweenDuration).call(it().tickSize(-(l-i.margin.left-i.margin.right)).tickFormat(""));i.show_legend&&u.addChartLegend();var n=w.selectAll("rect").data(i.data);n.enter().append("rect").attr("class","bar_item").style("fill",function(n){var t=u.getDistinctDataIndex(n[i.params.group_name]);return i.colors[t]}).style("opacity",i.bars.opacity).attr("x",function(n){var t=u.getDistinctDataIndex(n[i.params.group_name]);return e(n[i.params.name])+t*e.bandwidth()/r.length}).attr("y",function(){return o(0)}).attr("width",function(){return e.bandwidth()/r.length}).attr("height",0).on("mouseover",function(n){if(!i.bars.disable_hover){var t=n[i.params.group_name]+", "+i.bars.hover_name_text+": "+n[i.params.name]+", "+i.bars.hover_value_text+": "+g(n[i.params.value]);y.append("text").attr("class","title-text").style("fill",function(){var t=u.getDistinctDataIndex(n[i.params.group_name]);return i.colors[t]}).text(t).attr("text-anchor","middle").attr("x",l/2).attr("y",f-7);d3.select(this).style("opacity",i.bars.opacity_hover).style("cursor","pointer")}}).on("mouseout",function(){i.bars.disable_hover||(y.select(".title-text").remove(),d3.select(this).style("opacity",i.bars.opacity))}).transition().duration(i.tweenDuration).attr("y",function(n){return o(n[i.params.value])}).attr("height",function(n){return h-i.margin.top-i.margin.bottom-f-o(n[i.params.value])});n.data(i.data).transition().duration(i.tweenDuration).style("fill",function(n){var t=u.getDistinctDataIndex(n[i.params.group_name]);return i.colors[t]}).attr("x",function(n){var t=u.getDistinctDataIndex(n[i.params.group_name]);return e(n[i.params.name])+t*e.bandwidth()/r.length}).attr("width",e.bandwidth()/r.length).attr("y",function(n){return o(n[i.params.value])}).attr("height",function(n){return h-i.margin.top-i.margin.bottom-f-o(n[i.params.value])});n.exit().transition().duration(i.tweenDuration).style("opacity",0).remove()},u.addChartLegend=function(){var n=d.selectAll("li").data(r),u=n.enter().append("li"),t;u.append("div").attr("style",function(n,t){return"background-color: "+i.colors[t]});u.append("p").text(function(n){return n});t=n.data(r);t.select("div").attr("style",function(n,t){return"background-color: "+i.colors[t]});t.select("p").text(function(n){return n});n.exit().remove()},u.updateChart=function(t){i=n.extend(i,t);r=[];n.each(i.data,function(n,t){r.push(t[i.params.group_name])});r=n.unique(r);u.render()},u.getDistinctDataIndex=function(t){var i=0;return n.each(r,function(n,r){if(t==r)return i=n,!1}),i},u.render(),u}})(jQuery);